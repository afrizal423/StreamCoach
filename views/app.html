<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyze Stream - StreamCoach AI</title>
    <meta name="description" content="Upload your live stream video for a detailed AI audit. Get actionable insights on your sales performance, audio quality, and visual presentation.">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="http://streamcoach.afrizalmy.com/app">
    <meta property="og:title" content="Analyze Stream - StreamCoach AI">
    <meta property="og:description" content="Upload your live stream video for a detailed AI audit.">
    <meta property="og:image" content="https://placehold.co/1200x630/4F46E5/FFFFFF?text=StreamCoach+Analysis">

    <link rel="icon" type="image/png" href="https://placehold.co/32/4F46E5/FFFFFF?text=SC.ai">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        [v-cloak] { display: none; }
        .progress-bar-fill {
            transition: width 0.5s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 font-sans">
    <div id="app" v-cloak>
        <!-- Navigation -->
        <nav class="bg-white/80 backdrop-blur-md sticky top-0 z-50 shadow-sm border-b border-gray-100">
            <div class="container mx-auto px-6 py-4 flex justify-between items-center">
                <a href="/" class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-purple-600 flex items-center">
                    <i class="fas fa-video mr-2 text-indigo-600"></i>
                    <span class="hidden sm:inline">StreamCoach AI</span>
                </a>
                <div class="flex items-center space-x-2 sm:space-x-4">
                    <select v-model="currentLang" @change="setLang(currentLang)" class="bg-transparent border border-gray-300 text-gray-700 text-xs sm:text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block p-1.5 sm:p-2">
                        <option value="en">English ðŸ‡ºðŸ‡¸</option>
                        <option value="id">Indonesia ðŸ‡®ðŸ‡©</option>
                        <option value="es">EspaÃ±ol ðŸ‡ªðŸ‡¸</option>
                        <option value="zh">ä¸­æ–‡ ðŸ‡¨ðŸ‡³</option>
                        <option value="ja">æ—¥æœ¬èªž ðŸ‡¯ðŸ‡µ</option>
                    </select>
                    <div class="flex items-center bg-green-50 px-2 sm:px-3 py-1 rounded-full border border-green-100">
                        <div class="w-1.5 h-1.5 sm:w-2 sm:h-2 bg-green-500 rounded-full mr-1.5 sm:mr-2 animate-pulse"></div>
                        <span class="text-[10px] sm:text-xs font-semibold text-green-700 whitespace-nowrap">{{ t.apiKeyActive }}</span>
                    </div>
                    <button @click="logout" class="text-xs sm:text-sm font-medium text-gray-500 hover:text-red-600 transition-colors">{{ t.logout }}</button>
                </div>
            </div>
        </nav>

        <main class="container mx-auto px-6 py-12 max-w-5xl">
            <!-- Upload Section -->
            <div v-if="!loading && !result" class="bg-white rounded-3xl shadow-xl p-10 border border-gray-100 relative overflow-hidden">
                <div class="absolute top-0 right-0 w-64 h-64 bg-indigo-50 rounded-full mix-blend-multiply filter blur-3xl opacity-30 -translate-y-1/2 translate-x-1/2"></div>
                <div class="relative z-10">
                    <h2 class="text-4xl font-extrabold mb-2 text-center text-gray-900">{{ t.newSession }}</h2>
                    <p class="text-center text-gray-500 mb-10">{{ t.uploadDesc }}</p>
                    
                    <div class="max-w-xl mx-auto space-y-8">
                        <!-- Category Selection -->
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-3 ml-1">{{ t.categoryLabel }}</label>
                            <div class="relative">
                                <i class="fas fa-tag absolute left-4 top-3.5 text-gray-400"></i>
                                <select v-model="category" class="w-full bg-gray-50 border border-gray-200 text-gray-700 rounded-xl py-3 pl-10 pr-4 focus:ring-2 focus:ring-indigo-500 focus:bg-white focus:outline-none transition-all appearance-none">
                                    <option value="Jewelry">{{ t.catJewelry }}</option>
                                    <option value="Fashion">{{ t.catFashion }}</option>
                                    <option value="General Sales">{{ t.catSales }}</option>
                                    <option value="Gaming">{{ t.catGaming }}</option>
                                    <option value="Education">{{ t.catEducation }}</option>
                                </select>
                                <i class="fas fa-chevron-down absolute right-4 top-4 text-gray-400 pointer-events-none text-xs"></i>
                            </div>
                        </div>

                        <!-- File Dropzone -->
                        <div 
                            @dragover.prevent="dragover = true" 
                            @dragleave.prevent="dragover = false" 
                            @drop.prevent="handleDrop"
                            :class="['border-2 border-dashed rounded-3xl p-12 text-center transition-all duration-300 cursor-pointer group relative overflow-hidden', dragover ? 'border-indigo-500 bg-indigo-50 scale-[1.02]' : 'border-gray-300 hover:border-indigo-400 hover:bg-gray-50']"
                            @click="$refs.fileInput.click()"
                        >
                            <input type="file" ref="fileInput" class="hidden" @change="handleFileSelect" accept="video/*">
                            
                            <div class="relative z-10">
                                <div class="w-20 h-20 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform duration-300">
                                    <i class="fas fa-cloud-upload-alt text-4xl text-indigo-600"></i>
                                </div>
                                <div v-if="!file">
                                    <p class="text-xl font-bold text-gray-800 mb-2">{{ t.dragDrop }}</p>
                                    <p class="text-sm text-gray-500">{{ t.browse }}</p>
                                    <p class="text-xs text-gray-400 mt-4">{{ t.fileSupport }}</p>
                                </div>
                                <div v-else>
                                    <p class="text-lg font-bold text-indigo-700 break-all">{{ file.name }}</p>
                                    <p class="text-sm text-gray-500 mt-1">{{ (file.size / (1024*1024)).toFixed(2) }} MB</p>
                                    <div class="mt-4 inline-flex items-center text-xs text-indigo-600 font-semibold uppercase tracking-wide bg-indigo-50 px-3 py-1 rounded-full">
                                        <i class="fas fa-check-circle mr-1"></i> {{ t.ready }}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <button 
                            @click="startAnalysis" 
                            :disabled="!file || !category"
                            class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-bold py-4 rounded-xl text-lg shadow-lg hover:shadow-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed transform hover:-translate-y-0.5"
                        >
                            {{ t.analyzeBtn }}
                        </button>
                    </div>
                </div>
            </div>

            <!-- Loading State -->
            <div v-if="loading" class="bg-white rounded-3xl shadow-xl p-16 text-center border border-gray-100">
                <div class="relative w-32 h-32 mx-auto mb-8">
                    <div class="absolute inset-0 border-4 border-indigo-100 rounded-full"></div>
                    <div class="absolute inset-0 border-4 border-indigo-600 rounded-full border-t-transparent animate-spin"></div>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <i class="fas fa-magic text-3xl text-indigo-600 animate-pulse"></i>
                    </div>
                </div>
                <h2 class="text-3xl font-bold mb-4 text-gray-900">{{ t.analyzingTitle }}</h2>
                <p class="text-gray-500 mb-10 text-lg">{{ t.analyzingDesc }}</p>
                
                <div class="max-w-md mx-auto">
                    <div class="w-full bg-gray-100 rounded-full h-3 mb-3 overflow-hidden">
                        <div class="bg-gradient-to-r from-indigo-500 to-purple-500 h-full progress-bar-fill shadow-[0_0_10px_rgba(99,102,241,0.5)]" :style="{ width: progress + '%' }"></div>
                    </div>
                    <p class="text-sm font-semibold text-indigo-600">{{ progress }}% {{ t.complete }}</p>
                </div>
            </div>

            <!-- Result Display -->
            <div v-if="result" class="space-y-8 animate-fade-in-up">
                <!-- Overview Card -->
                <div class="bg-white rounded-3xl shadow-xl p-8 md:p-10 border border-gray-100 flex flex-col md:flex-row items-center gap-10">
                    <div class="relative w-48 h-48 flex-shrink-0">
                        <svg class="w-full h-full -rotate-90" viewBox="0 0 36 36">
                            <circle cx="18" cy="18" r="15.9155" class="stroke-gray-100" stroke-width="2.5" fill="none" />
                            <circle cx="18" cy="18" r="15.9155" :class="['fill-none', scoreColor]" stroke-width="2.5" :stroke-dasharray="result.overall_score + ', 100'" stroke-linecap="round" />
                        </svg>
                        <div class="absolute inset-0 flex flex-col items-center justify-center">
                            <span class="text-5xl font-extrabold text-gray-900">{{ result.overall_score }}</span>
                            <span class="text-xs font-bold text-gray-400 uppercase tracking-widest mt-1">{{ t.score }}</span>
                        </div>
                    </div>
                    <div class="flex-1">
                        <div class="inline-block px-3 py-1 bg-indigo-50 text-indigo-700 rounded-full text-xs font-bold uppercase tracking-wide mb-4">{{ t.execSummary }}</div>
                        <h2 class="text-3xl font-bold mb-4 text-gray-900">{{ t.reportTitle }}</h2>
                        <p class="text-gray-600 leading-relaxed text-lg">{{ result.summary_reasoning }}</p>
                    </div>
                </div>

                <div class="grid md:grid-cols-2 gap-8">
                    <!-- Strengths -->
                    <div class="bg-white rounded-3xl p-8 border border-green-100 shadow-sm relative overflow-hidden">
                        <div class="absolute top-0 right-0 w-32 h-32 bg-green-50 rounded-full -translate-y-1/2 translate-x-1/2 opacity-50"></div>
                        <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                            <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center mr-3">
                                <i class="fas fa-check text-green-600"></i>
                            </div>
                            {{ t.strengths }}
                        </h3>
                        <ul class="space-y-4">
                            <li v-for="s in result.strengths" :key="s" class="flex items-start">
                                <i class="fas fa-check-circle text-green-500 mt-1 mr-3 flex-shrink-0"></i>
                                <span class="text-gray-700">{{ s }}</span>
                            </li>
                        </ul>
                    </div>
                    <!-- Weaknesses -->
                    <div class="bg-white rounded-3xl p-8 border border-red-100 shadow-sm relative overflow-hidden">
                        <div class="absolute top-0 right-0 w-32 h-32 bg-red-50 rounded-full -translate-y-1/2 translate-x-1/2 opacity-50"></div>
                        <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                            <div class="w-10 h-10 rounded-full bg-red-100 flex items-center justify-center mr-3">
                                <i class="fas fa-exclamation text-red-600"></i>
                            </div>
                            {{ t.weaknesses }}
                        </h3>
                        <ul class="space-y-4">
                            <li v-for="w in result.weaknesses" :key="w" class="flex items-start">
                                <i class="fas fa-times-circle text-red-500 mt-1 mr-3 flex-shrink-0"></i>
                                <span class="text-gray-700">{{ w }}</span>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Timeline Flags -->
                <div class="bg-white rounded-3xl shadow-xl p-8 md:p-10 border border-gray-100">
                    <h3 class="text-2xl font-bold mb-8 text-gray-900 flex items-center">
                        <i class="fas fa-clock text-indigo-500 mr-3"></i> {{ t.timeline }}
                    </h3>
                    <div class="space-y-4">
                        <div v-for="flag in result.timeline_flags" :key="flag.time" class="flex flex-col md:flex-row md:items-center p-5 bg-gray-50 rounded-2xl border border-gray-100 hover:border-indigo-200 transition-colors">
                            <div class="flex items-center mb-3 md:mb-0 md:mr-6">
                                <div class="bg-white border border-gray-200 text-gray-700 px-4 py-1.5 rounded-lg font-mono font-bold text-sm shadow-sm">
                                    {{ flag.time }}
                                </div>
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center">
                                    <span :class="['text-[10px] font-extrabold uppercase px-2 py-1 rounded-md mr-3 tracking-wider', flag.severity.toLowerCase() === 'high' ? 'bg-red-100 text-red-700' : (flag.severity.toLowerCase() === 'medium' ? 'bg-orange-100 text-orange-700' : 'bg-yellow-100 text-yellow-700')]">
                                        {{ flag.severity }}
                                    </span>
                                    <span class="font-medium text-gray-800">{{ flag.issue }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Actionable Advice -->
                <div class="bg-gradient-to-br from-indigo-600 to-purple-700 rounded-3xl shadow-xl p-8 md:p-10 text-white relative overflow-hidden">
                    <div class="absolute top-0 right-0 -mt-10 -mr-10 w-40 h-40 bg-white opacity-10 rounded-full blur-2xl"></div>
                    <div class="relative z-10">
                        <h3 class="text-2xl font-bold mb-6 flex items-center">
                            <i class="fas fa-lightbulb text-yellow-300 mr-3 text-2xl"></i> {{ t.coachAdvice }}
                        </h3>
                        <div class="bg-white/10 rounded-2xl p-6 backdrop-blur-sm border border-white/10">
                            <p class="text-indigo-50 text-lg leading-relaxed italic">"{{ result.improvement_tips }}"</p>
                        </div>
                    </div>
                </div>

                <div class="flex flex-col md:flex-row justify-center items-center gap-4 pt-8 pb-12">
                    <button @click="reset" class="px-6 py-3 rounded-xl text-gray-500 hover:text-indigo-600 hover:bg-indigo-50 font-bold transition-colors">
                        <i class="fas fa-redo mr-2"></i> {{ t.analyzeAnother }}
                    </button>
                    <button @click="exportPDF" class="px-8 py-3 bg-gray-900 text-white rounded-xl font-bold shadow-lg hover:bg-gray-800 hover:shadow-xl transition-all transform hover:-translate-y-0.5 flex items-center">
                        <i class="fas fa-file-pdf mr-2"></i> {{ t.downloadPDF }}
                    </button>
                </div>
            </div>
        </main>
    </div>

    <script>
        const { createApp, ref, computed, onMounted } = Vue;

        const translations = {
            en: {
                apiKeyActive: "API Key Active",
                logout: "Logout",
                newSession: "New Audit Session",
                uploadDesc: "Upload your stream recording to get started.",
                categoryLabel: "Stream Category",
                catJewelry: "Jewelry & Accessories",
                catFashion: "Fashion & Apparel",
                catSales: "General Sales",
                catGaming: "Gaming / E-sports",
                catEducation: "Education / Tutorial",
                dragDrop: "Drag & Drop your video here",
                browse: "or click to browse files",
                fileSupport: "Supports MP4, MOV, AVI (Max 1GB)",
                ready: "Ready to Upload",
                analyzeBtn: "Analyze Stream",
                analyzingTitle: "Analyzing Performance",
                analyzingDesc: "Gemini is watching and listening to your stream...",
                uploading: "Uploading video...",
                queued: "Waiting in queue... (Server busy)",
                processing: "Processing video...",
                extracting: "Extracting audio and frames...",
                gemini: "Gemini is analyzing your performance...",
                complete: "Complete",
                score: "Score",
                execSummary: "Executive Summary",
                reportTitle: "Analysis Report",
                strengths: "Key Strengths",
                weaknesses: "Growth Areas",
                timeline: "Timeline Analysis",
                coachAdvice: "Coach's Top Advice",
                analyzeAnother: "Analyze Another Video",
                downloadPDF: "Download Report (PDF)",
                fileTooLarge: "File too large. Maximum size is 1GB.",
                errorTitle: "Oops...",
                pdfTitle: "StreamCoach AI Analysis Report",
                pdfGenerated: "Generated on",
                pdfSummary: "Summary",
                pdfStrengths: "Strengths",
                pdfWeaknesses: "Areas for Improvement",
                pdfTimeline: "Timeline Analysis",
                pdfTime: "Time",
                pdfSeverity: "Severity",
                pdfIssue: "Issue",
                pdfAdvice: "Coach's Advice"
            },
            id: {
                apiKeyActive: "API Key Aktif",
                logout: "Keluar",
                newSession: "Sesi Audit Baru",
                uploadDesc: "Unggah rekaman stream Anda untuk memulai.",
                categoryLabel: "Kategori Stream",
                catJewelry: "Perhiasan & Aksesoris",
                catFashion: "Fashion & Pakaian",
                catSales: "Penjualan Umum",
                catGaming: "Gaming / E-sports",
                catEducation: "Pendidikan / Tutorial",
                dragDrop: "Seret & Lepas video Anda di sini",
                browse: "atau klik untuk mencari file",
                fileSupport: "Mendukung MP4, MOV, AVI (Maks 1GB)",
                ready: "Siap Diunggah",
                analyzeBtn: "Analisis Stream",
                analyzingTitle: "Menganalisis Performa",
                analyzingDesc: "Gemini sedang menonton dan mendengarkan stream Anda...",
                uploading: "Mengunggah video...",
                queued: "Menunggu antrian... (Server sibuk)",
                processing: "Memproses video...",
                extracting: "Mengekstrak audio dan frame...",
                gemini: "Gemini sedang menganalisis performa Anda...",
                complete: "Selesai",
                score: "Skor",
                execSummary: "Ringkasan Eksekutif",
                reportTitle: "Laporan Analisis",
                strengths: "Kekuatan Utama",
                weaknesses: "Area Pertumbuhan",
                timeline: "Analisis Linimasa",
                coachAdvice: "Saran Utama Pelatih",
                analyzeAnother: "Analisis Video Lain",
                downloadPDF: "Unduh Laporan (PDF)",
                fileTooLarge: "File terlalu besar. Ukuran maksimal adalah 1GB.",
                errorTitle: "Ups...",
                pdfTitle: "Laporan Analisis StreamCoach AI",
                pdfGenerated: "Dibuat pada",
                pdfSummary: "Ringkasan",
                pdfStrengths: "Kekuatan",
                pdfWeaknesses: "Area Perbaikan",
                pdfTimeline: "Analisis Linimasa",
                pdfTime: "Waktu",
                pdfSeverity: "Tingkat Keparahan",
                pdfIssue: "Masalah",
                pdfAdvice: "Saran Pelatih"
            },
            es: {
                apiKeyActive: "Clave API Activa",
                logout: "Cerrar SesiÃ³n",
                newSession: "Nueva SesiÃ³n de AuditorÃ­a",
                uploadDesc: "Sube tu grabaciÃ³n para comenzar.",
                categoryLabel: "CategorÃ­a del Stream",
                catJewelry: "JoyerÃ­a y Accesorios",
                catFashion: "Moda y Ropa",
                catSales: "Ventas Generales",
                catGaming: "Juegos / E-sports",
                catEducation: "EducaciÃ³n / Tutorial",
                dragDrop: "Arrastra y suelta tu video aquÃ­",
                browse: "o haz clic para buscar archivos",
                fileSupport: "Soporta MP4, MOV, AVI (Max 1GB)",
                ready: "Listo para subir",
                analyzeBtn: "Analizar Stream",
                analyzingTitle: "Analizando Rendimiento",
                analyzingDesc: "Gemini estÃ¡ viendo y escuchando tu stream...",
                uploading: "Subiendo video...",
                queued: "Esperando en cola... (Servidor ocupado)",
                processing: "Procesando video...",
                extracting: "Extrayendo audio y fotogramas...",
                gemini: "Gemini estÃ¡ analizando tu rendimiento...",
                complete: "Completado",
                score: "Puntaje",
                execSummary: "Resumen Ejecutivo",
                reportTitle: "Reporte de AnÃ¡lisis",
                strengths: "Fortalezas Clave",
                weaknesses: "Ãreas de Crecimiento",
                timeline: "AnÃ¡lisis de LÃ­nea de Tiempo",
                coachAdvice: "Consejo Principal del Coach",
                analyzeAnother: "Analizar Otro Video",
                downloadPDF: "Descargar Reporte (PDF)",
                fileTooLarge: "Archivo demasiado grande. El tamaÃ±o mÃ¡ximo es 1GB.",
                errorTitle: "Ups...",
                pdfTitle: "Reporte de AnÃ¡lisis StreamCoach AI",
                pdfGenerated: "Generado el",
                pdfSummary: "Resumen",
                pdfStrengths: "Fortalezas",
                pdfWeaknesses: "Ãreas de Mejora",
                pdfTimeline: "AnÃ¡lisis de LÃ­nea de Tiempo",
                pdfTime: "Tiempo",
                pdfSeverity: "Severidad",
                pdfIssue: "Problema",
                pdfAdvice: "Consejo del Coach"
            },
            zh: {
                apiKeyActive: "API å¯†é’¥å·²æ¿€æ´»",
                logout: "ç™»å‡º",
                newSession: "æ–°å®¡æ ¸ä¼šè¯",
                uploadDesc: "ä¸Šä¼ æ‚¨çš„ç›´æ’­å½•åƒä»¥å¼€å§‹ã€‚",
                categoryLabel: "ç›´æ’­ç±»åˆ«",
                catJewelry: "ç å®ä¸Žé…é¥°",
                catFashion: "æ—¶å°šä¸Žæœé¥°",
                catSales: "ä¸€èˆ¬é”€å”®",
                catGaming: "æ¸¸æˆ / ç”µå­ç«žæŠ€",
                catEducation: "æ•™è‚² / æ•™ç¨‹",
                dragDrop: "å°†è§†é¢‘æ‹–æ”¾åˆ°æ­¤å¤„",
                browse: "æˆ–ç‚¹å‡»æµè§ˆæ–‡ä»¶",
                fileSupport: "æ”¯æŒ MP4, MOV, AVI (æœ€å¤§ 1GB)",
                ready: "å‡†å¤‡ä¸Šä¼ ",
                analyzeBtn: "åˆ†æžç›´æ’­",
                analyzingTitle: "åˆ†æžè¡¨çŽ°",
                analyzingDesc: "Gemini æ­£åœ¨è§‚çœ‹å’Œæ”¶å¬æ‚¨çš„ç›´æ’­...",
                uploading: "æ­£åœ¨ä¸Šä¼ è§†é¢‘...",
                queued: "æŽ’é˜Ÿä¸­... (æœåŠ¡å™¨ç¹å¿™)",
                processing: "æ­£åœ¨å¤„ç†è§†é¢‘...",
                extracting: "æ­£åœ¨æå–éŸ³é¢‘å’Œå¸§...",
                gemini: "Gemini æ­£åœ¨åˆ†æžæ‚¨çš„è¡¨çŽ°...",
                complete: "å®Œæˆ",
                score: "åˆ†æ•°",
                execSummary: "æ‰§è¡Œæ‘˜è¦",
                reportTitle: "åˆ†æžæŠ¥å‘Š",
                strengths: "ä¸»è¦ä¼˜åŠ¿",
                weaknesses: "å¢žé•¿é¢†åŸŸ",
                timeline: "æ—¶é—´çº¿åˆ†æž",
                coachAdvice: "æ•™ç»ƒçš„ä¸»è¦å»ºè®®",
                analyzeAnother: "åˆ†æžå¦ä¸€ä¸ªè§†é¢‘",
                downloadPDF: "ä¸‹è½½æŠ¥å‘Š (PDF)",
                fileTooLarge: "æ–‡ä»¶å¤ªå¤§ã€‚æœ€å¤§é™åˆ¶ä¸º 1GBã€‚",
                errorTitle: "ç³Ÿç³•...",
                pdfTitle: "StreamCoach AI åˆ†æžæŠ¥å‘Š",
                pdfGenerated: "ç”ŸæˆäºŽ",
                pdfSummary: "æ‘˜è¦",
                pdfStrengths: "ä¼˜åŠ¿",
                pdfWeaknesses: "æ”¹è¿›é¢†åŸŸ",
                pdfTimeline: "æ—¶é—´çº¿åˆ†æž",
                pdfTime: "æ—¶é—´",
                pdfSeverity: "ä¸¥é‡ç¨‹åº¦",
                pdfIssue: "é—®é¢˜",
                pdfAdvice: "æ•™ç»ƒå»ºè®®"
            },
            ja: {
                apiKeyActive: "APIã‚­ãƒ¼æœ‰åŠ¹",
                logout: "ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ",
                newSession: "æ–°ã—ã„ç›£æŸ»ã‚»ãƒƒã‚·ãƒ§ãƒ³",
                uploadDesc: "ã‚¹ãƒˆãƒªãƒ¼ãƒ éŒ²ç”»ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦é–‹å§‹ã—ã¦ãã ã•ã„ã€‚",
                categoryLabel: "ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚«ãƒ†ã‚´ãƒª",
                catJewelry: "ã‚¸ãƒ¥ã‚¨ãƒªãƒ¼ï¼†ã‚¢ã‚¯ã‚»ã‚µãƒªãƒ¼",
                catFashion: "ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³ï¼†ã‚¢ãƒ‘ãƒ¬ãƒ«",
                catSales: "ä¸€èˆ¬è²©å£²",
                catGaming: "ã‚²ãƒ¼ãƒ  / Eã‚¹ãƒãƒ¼ãƒ„",
                catEducation: "æ•™è‚² / ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«",
                dragDrop: "ã“ã“ã«å‹•ç”»ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—",
                browse: "ã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§",
                fileSupport: "MP4, MOV, AVI å¯¾å¿œ (æœ€å¤§ 1GB)",
                ready: "ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æº–å‚™å®Œäº†",
                analyzeBtn: "ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’åˆ†æž",
                analyzingTitle: "ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹åˆ†æžä¸­",
                analyzingDesc: "GeminiãŒã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’è¦–è´ã—ã¦ã„ã¾ã™...",
                uploading: "å‹•ç”»ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...",
                queued: "é †ç•ªå¾…ã¡ä¸­... (ã‚µãƒ¼ãƒãƒ¼æ··é›‘)",
                processing: "å‹•ç”»ã‚’å‡¦ç†ä¸­...",
                extracting: "éŸ³å£°ã¨ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’æŠ½å‡ºä¸­...",
                gemini: "GeminiãŒãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ã‚’åˆ†æžä¸­...",
                complete: "å®Œäº†",
                score: "ã‚¹ã‚³ã‚¢",
                execSummary: "ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒžãƒªãƒ¼",
                reportTitle: "åˆ†æžãƒ¬ãƒãƒ¼ãƒˆ",
                strengths: "ä¸»ãªå¼·ã¿",
                weaknesses: "æˆé•·åˆ†é‡Ž",
                timeline: "ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³åˆ†æž",
                coachAdvice: "ã‚³ãƒ¼ãƒã‹ã‚‰ã®ãƒˆãƒƒãƒ—ã‚¢ãƒ‰ãƒã‚¤ã‚¹",
                analyzeAnother: "åˆ¥ã®å‹•ç”»ã‚’åˆ†æž",
                downloadPDF: "ãƒ¬ãƒãƒ¼ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ (PDF)",
                fileTooLarge: "ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¤§ãã™ãŽã¾ã™ã€‚æœ€å¤§ã‚µã‚¤ã‚ºã¯1GBã§ã™ã€‚",
                errorTitle: "ãŠã£ã¨...",
                pdfTitle: "StreamCoach AI åˆ†æžãƒ¬ãƒãƒ¼ãƒˆ",
                pdfGenerated: "ä½œæˆæ—¥",
                pdfSummary: "ã‚µãƒžãƒªãƒ¼",
                pdfStrengths: "å¼·ã¿",
                pdfWeaknesses: "æ”¹å–„åˆ†é‡Ž",
                pdfTimeline: "ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³åˆ†æž",
                pdfTime: "æ™‚é–“",
                pdfSeverity: "é‡è¦åº¦",
                pdfIssue: "å•é¡Œ",
                pdfAdvice: "ã‚³ãƒ¼ãƒã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹"
            }
        };

        createApp({
            setup() {
                const apiKey = ref('');
                const category = ref('Jewelry');
                const file = ref(null);
                const dragover = ref(false);
                const loading = ref(false);
                const loadingText = ref('Uploading video...');
                const progress = ref(0);
                const result = ref(null);
                const currentLang = ref('en');

                onMounted(() => {
                    apiKey.value = localStorage.getItem('gemini_api_key');
                    if (!apiKey.value) window.location.href = '/';
                    
                    const savedLang = localStorage.getItem('app_lang');
                    if (savedLang && translations[savedLang]) {
                        currentLang.value = savedLang;
                    }
                });

                const t = computed(() => translations[currentLang.value]);

                const setLang = (lang) => {
                    currentLang.value = lang;
                    localStorage.setItem('app_lang', lang);
                };

                const handleFileSelect = (e) => {
                    file.value = e.target.files[0];
                };

                const handleDrop = (e) => {
                    dragover.value = false;
                    file.value = e.dataTransfer.files[0];
                };

                const startAnalysis = async () => {
                    // Check file size (1GB limit)
                    if (file.value && file.value.size > 1 * 1024 * 1024 * 1024) {
                        Swal.fire({
                            icon: 'error',
                            title: t.value.errorTitle,
                            text: t.value.fileTooLarge,
                        });
                        return;
                    }

                    loading.value = true;
                    progress.value = 5;
                    loadingText.value = t.value.uploading;

                    const formData = new FormData();
                    formData.append('video', file.value);
                    formData.append('apiKey', apiKey.value);
                    formData.append('category', category.value);
                    formData.append('language', currentLang.value);

                    try {
                        // 1. Upload File
                        const uploadResp = await fetch('/api/upload', {
                            method: 'POST',
                            body: formData
                        });

                        if (!uploadResp.ok) {
                            const errorText = await uploadResp.text();
                            throw new Error(errorText || 'Upload failed');
                        }

                        const { jobId } = await uploadResp.json();
                        progress.value = 20;
                        loadingText.value = t.value.queued; // Initial state

                        // 2. Poll Status
                        const pollInterval = setInterval(async () => {
                            try {
                                const statusResp = await fetch(`/api/status?id=${jobId}`);
                                if (!statusResp.ok) return; // Retry next time

                                const job = await statusResp.json();

                                if (job.status === 'queued') {
                                    loadingText.value = t.value.queued;
                                    progress.value = 25; // Stuck at 25 while queued
                                } else if (job.status === 'processing') {
                                    // Simulate visual progress for processing
                                    if (progress.value < 90) progress.value += 2;
                                    loadingText.value = t.value.gemini;
                                } else if (job.status === 'completed') {
                                    clearInterval(pollInterval);
                                    progress.value = 100;
                                    result.value = job.result;
                                    loading.value = false;
                                } else if (job.status === 'failed') {
                                    clearInterval(pollInterval);
                                    throw new Error(job.error || 'Analysis failed');
                                }
                            } catch (err) {
                                clearInterval(pollInterval);
                                Swal.fire({
                                    icon: 'error',
                                    title: t.value.errorTitle,
                                    text: err.message,
                                });
                                loading.value = false;
                            }
                        }, 2000);

                    } catch (error) {
                        Swal.fire({
                            icon: 'error',
                            title: t.value.errorTitle,
                            text: error.message,
                        });
                        loading.value = false;
                    }
                };

                const scoreColor = computed(() => {
                    if (!result.value) return 'stroke-indigo-600';
                    const s = result.value.overall_score;
                    if (s >= 80) return 'stroke-green-500';
                    if (s >= 60) return 'stroke-yellow-500';
                    return 'stroke-red-500';
                });

                const logout = () => {
                    localStorage.removeItem('gemini_api_key');
                    window.location.href = '/';
                };

                const reset = () => {
                    result.value = null;
                    file.value = null;
                    progress.value = 0;
                };

                const exportPDF = () => {
                    if (!result.value) return;
                    
                    const { jsPDF } = window.jspdf;
                    // Support Chinese/Japanese fonts would require adding a custom font file (base64)
                    // For this hackathon demo, we will rely on standard fonts, which might display boxes for CJK characters in PDF.
                    // To partially mitigate, we'll stick to standard font but note this limitation.
                    
                    const doc = new jsPDF();
                    const r = result.value;
                    const lang = t.value;

                    // Title
                    doc.setFontSize(20);
                    doc.setTextColor(79, 70, 229); // Indigo 600
                    doc.text(lang.pdfTitle, 105, 20, null, "center");
                    
                    doc.setFontSize(10);
                    doc.setTextColor(100);
                    doc.text(`${lang.pdfGenerated}: ${new Date().toLocaleString()}`, 105, 28, null, "center");

                    let yPos = 40;

                    // Overall Score
                    doc.setFontSize(14);
                    doc.setTextColor(0);
                    doc.text(`${lang.score}: ${r.overall_score}/100`, 14, yPos);
                    yPos += 10;

                    // Summary
                    doc.setFontSize(12);
                    doc.setTextColor(0);
                    doc.setFont(undefined, 'bold');
                    doc.text(`${lang.pdfSummary}:`, 14, yPos);
                    yPos += 7;
                    doc.setFont(undefined, 'normal');
                    doc.setFontSize(10);
                    const summaryLines = doc.splitTextToSize(r.summary_reasoning, 180);
                    doc.text(summaryLines, 14, yPos);
                    yPos += (summaryLines.length * 5) + 5;

                    // Strengths & Weaknesses
                    doc.setFontSize(12);
                    doc.setFont(undefined, 'bold');
                    doc.setTextColor(22, 163, 74); // Green
                    doc.text(`${lang.pdfStrengths}:`, 14, yPos);
                    yPos += 7;
                    doc.setFont(undefined, 'normal');
                    doc.setTextColor(0);
                    doc.setFontSize(10);
                    r.strengths.forEach(s => {
                        const lines = doc.splitTextToSize(`â€¢ ${s}`, 180);
                        doc.text(lines, 14, yPos);
                        yPos += (lines.length * 5);
                    });
                    yPos += 5;

                    doc.setFontSize(12);
                    doc.setFont(undefined, 'bold');
                    doc.setTextColor(220, 38, 38); // Red
                    doc.text(`${lang.pdfWeaknesses}:`, 14, yPos);
                    yPos += 7;
                    doc.setFont(undefined, 'normal');
                    doc.setTextColor(0);
                    doc.setFontSize(10);
                    r.weaknesses.forEach(w => {
                        const lines = doc.splitTextToSize(`â€¢ ${w}`, 180);
                        doc.text(lines, 14, yPos);
                        yPos += (lines.length * 5);
                    });
                    yPos += 10;

                    // Timeline Flags (Table)
                    doc.setFontSize(12);
                    doc.setFont(undefined, 'bold');
                    doc.text(`${lang.pdfTimeline}:`, 14, yPos);
                    yPos += 5;

                    const tableData = r.timeline_flags.map(f => [f.time, f.severity.toUpperCase(), f.issue]);
                    
                    doc.autoTable({
                        startY: yPos,
                        head: [[lang.pdfTime, lang.pdfSeverity, lang.pdfIssue]],
                        body: tableData,
                        theme: 'grid',
                        headStyles: { fillColor: [79, 70, 229] },
                        styles: { fontSize: 9 },
                        columnStyles: {
                            0: { cellWidth: 20 },
                            1: { cellWidth: 25 },
                            2: { cellWidth: 'auto' }
                        }
                    });

                    yPos = doc.lastAutoTable.finalY + 10;

                    // Improvement Tips
                    // Check if new page is needed
                    if (yPos > 250) {
                        doc.addPage();
                        yPos = 20;
                    }

                    doc.setFontSize(12);
                    doc.setFont(undefined, 'bold');
                    doc.setTextColor(79, 70, 229);
                    doc.text(`${lang.pdfAdvice}:`, 14, yPos);
                    yPos += 7;
                    doc.setFont(undefined, 'normal');
                    doc.setTextColor(0);
                    doc.setFontSize(10);
                    const tipsLines = doc.splitTextToSize(r.improvement_tips, 180);
                    doc.text(tipsLines, 14, yPos);

                    doc.save("streamcoach_analysis.pdf");
                };

                return {
                    category, file, dragover, loading, loadingText, progress, result,
                    handleFileSelect, handleDrop, startAnalysis, scoreColor, logout, reset, exportPDF,
                    t, currentLang, setLang
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
